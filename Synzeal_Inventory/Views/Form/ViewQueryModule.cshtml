@{
    ViewBag.Title = "View Query" + Model.QueryNo;
    Layout = "~/Views/Shared/_Layout.cshtml";
    Synzeal_Inventory.Entity.SZ_SolutionModule solution = ViewBag.SolutionData as Synzeal_Inventory.Entity.SZ_SolutionModule;
}
@model Synzeal_Inventory.Entity.SZ_QueryModule
<section class="content-header">
    <h1>
        Query Solution
        <a href="/Form/QueryModule?view=@ViewBag.pagename" class="pull-right btn btn-primary">Back</a>
    </h1>
</section>
<section class="content">
    <section class="invoice">
        <!-- title row -->
        <div class="row">
            <div class="col-xs-12">
                <h2 class="page-header">
                    # @Model.QueryNo
                    <small class="pull-right">Date: @Model.CreatedDate.Value.ToShortDateString()</small>
                    @if (Model.ClosingDate.HasValue)
                    {
                        <br />
                        <small class="pull-right">Closing Date: @Model.ClosingDate.Value.ToShortDateString()</small>
                    }
                    <div class="clearfix"></div>
                </h2>
            </div>
            <!-- /.col -->
        </div>
        <!-- info row -->
        <div class="row invoice-info">
            <div class="col-sm-4 invoice-col">
                <b>Query Detail</b>
                <address>
                    @Html.Raw(Model.ClientRemark)
                </address>
            </div>
            <!-- /.col -->
            <div class="col-sm-4 invoice-col">
                <div class="table-responsive">
                    <table class="table">
                        <tbody>
                            <tr>
                                <th style="width:50%">Sub Status</th>
                                <td>
                                    @Model.SubStatus
                                </td>
                            </tr>
                            <tr>
                                <th style="width:50%">Team Leader</th>
                                <td>
                                    @ViewBag.teamLeaderName
                                </td>
                            </tr>
                            <tr>
                                <th style="width:50%">Sub Scientist</th>
                                <td>
                                    @ViewBag.subscientistname
                                </td>
                            </tr>
                            <tr>
                                <th style="width:50%">Product Name</th>
                                <td>@Model.ProductName</td>
                            </tr>
                            <tr>
                                <th>CAT No</th>
                                <td>@Model.CATNo</td>
                            </tr>
                            <tr>
                                <th>CAS No:</th>
                                <td>@Model.CASNo</td>
                            </tr>
                            <tr>
                                <th>Batch Code:</th>
                                <td>@Model.BatchNo</td>
                            </tr>
                            <tr>
                                <th>Qty:</th>
                                <td>@Model.Qty</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- /.col -->
            <div class="col-sm-4 invoice-col">
                <img src="@ViewBag.imageURL" width="100%" />

            </div>
            <!-- /.col -->
            <div class="clearfix"></div>
            <div class="col-md-12">
                <b>Synonym: </b>@ViewBag.Synonym
            </div>
            <!-- /.row -->
            <!-- Table row -->
            <div class="col-md-12">
                <br /><br />
                @if (solution != null)
                {
                    <div >
                        <div class="form-group">
                            <b>Solution # </b>@solution.Id
                        </div>
                        <div class="form-group">
                            <b>Analytic/Technical View: </b>@solution.Solution
                        </div>
                        <div class="form-group">
                            <b>Query Understanding: </b>@solution.Cause
                        </div>
                        <div class="form-group">
                            <b>Final Solution: </b>@solution.Remark
                        </div>
                    </div>
                }
                <div class="col-xs-12 table-responsive" id="divVerbal" style="display:none">
                    <textarea id="solutiontext" name="solutiontext" rows="6" style="width:100%"></textarea>
                    <div class="row no-print">
                        <button type="button" class="btn btn-success pull-right" onclick="addsolutiontext()">
                            <i class="fa fa-credit-card"></i> Add Solution
                        </button>
                    </div>
                </div>
            </div>
            <!-- /.col -->
        </div>
        <!-- /.row -->
        <!-- /.row -->
        <!-- this row will not appear when printing -->

    </section>
</section>


<script type="text/javascript">

    $("#SubStatus").val('@Model.SubStatus');
    $("#SubScientist").val('@Model.SubScientistName');
    function savedetails() {
        $.ajax({
            url: '/Form/SaveQueryData?id=@Model.Id&SubStatus=' + encodeURIComponent($("#SubStatus").val()) + '&SubScientist=' + encodeURIComponent($("#SubScientist").val()),
            data: {},
            type: 'GET',
            success: function (data) {
                toastr.success("Updated details.");
            }
        });
    }
    function addsolutiontext() {
        var text = $("#solutiontext").val();
        if (text === "") {
            toastr.error("Please enter your solution.");
            return false;
        }
        $.ajax({
            url: '/Form/AssignSolutionText?id=@Model.Id&text=' + encodeURIComponent(text),
            data: {},
            type: 'GET',
            success: function (data) {
                toastr.success("Assigned solution.");
                window.location.href = "/Form/ScientistQueryModule";
            }
        });
    }
    $('input[type=radio][name=SolutionType]').change(function () {
        var value = $(this).val();
        if (value === "Technical") {
            $("#divTechnical").show();
            $("#divVerbal").hide();
        }
        else {
            $("#divTechnical").hide();
            $("#divVerbal").show();
        }
    });

    $('.clssolution').on('change', function () {
        $('.clssolution').not(this).prop('checked', false);
    });
    function assignSolution() {
        var solutionId = 0;
        $('.clssolution').each(function () {
            if ($(this).is(":checked")) {
                solutionId = $(this).val();
            }
        });
        if (solutionId === 0) {
            toastr.error("Please checked correct solution.");
            return false;
        }
        $.ajax({
            url: '/Form/AssignSolution?id=@Model.Id&SolutionId=' + solutionId,
            data: {},
            type: 'GET',
            success: function (data) {
                toastr.success("Assigned solution.");
                window.location.href = "/Form/ScientistQueryModule";
            }
        });
    }
    function addsolution()
    {
        $.ajax({
            url: '/Form/AddSolution?id=@Model.Id',
            data: {},
            type: 'GET',
            success: function (data) {
                $('.modal-body').html(data);
                $('#myModal').modal({ show: true });
                $(".modal-dialog").css("width", "1080px");
            }
        });

    }
</script>