@{
    ViewBag.Title = "Summary";
    Layout = "~/Views/Shared/_Layout.second.cshtml";
    int loop = 1;
}
@using Synzeal_Inventory.Models;
@model SummaryDashboard
<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0">@CommonOperation.GetLocalizestring("products.summary")</h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    @*<li class="breadcrumb-item"><a href="#">Home</a></li>*@
                    <li class="breadcrumb-item active"><a href="/Form/Graph" class="btn btn-success pull-right" style=" margin-left: 20px;"> @CommonOperation.GetLocalizestring("products.Graph")</a></li>
                </ol>
            </div><!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.container-fluid -->
</div>
<script src="https://adminlte.io/themes/AdminLTE/bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
<div class="row">
    <section class="col-lg-12 connectedSortable" style="margin-left:15px;">
        <label style=" float: left; padding-top: 6px;">@CommonOperation.GetLocalizestring("filter.startdate"):&nbsp;&nbsp;</label> <input type="text" class="form-control" id="startdate" style="width: 10%; float: left">
        <label style=" float: left; padding-top: 6px; margin-left: 20px;">@CommonOperation.GetLocalizestring("filter.enddate"):&nbsp;&nbsp;</label> <input type="text" class="form-control" id="enddate" style="width: 10%;float: left" />
        <a href="javascript:void(0)" class="btn btn-primary" style=" float: left; margin-left: 20px;" onclick="GetSummary()"> @CommonOperation.GetLocalizestring("common.search")</a>
        @*<a href="/Form/Graph" class="btn btn-success pull-right" style=" margin-left: 20px;"> Graph</a>*@

        <div class="clearfix" style="margin-bottom: 20px;"></div>
        <div class="col-12">
            <div class="card">
                <table id="example1" class="table table-bordered table-striped" style="width:100%">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>@CommonOperation.GetLocalizestring("address.fields.company")</th>
                            <th style="text-align:center">@CommonOperation.GetLocalizestring("Common.totalquotation")</th>
                            <th style="text-align:center">@CommonOperation.GetLocalizestring("Common.totalproducts")</th>
                            <th style="text-align:center">@CommonOperation.GetLocalizestring("common.totalpo")</th>
                            <th style="text-align:center">@CommonOperation.GetLocalizestring("common.totalpoproducts")</th>
                            @*<th>Total PO Value</th>*@
                            <th style="text-align:center">@CommonOperation.GetLocalizestring("common.conversionpercentage")</th>
                            <th style='text-align:center'>@CommonOperation.GetLocalizestring("common.action")</th>
                            <th>PO Value</th>
                        </tr>
                    </thead>
                    <tbody id="tbody">
                        @*<tr>
                                <td>1</td>
                                <td id="TotalQuote"></td>
                                <td id="TotalProduct"></td>
                                <td id="TotalPO"></td>
                                <td id="TotalPOProduct"></td>
                                <td id="PercentageConvert"></td>
                            </tr>*@

                        @*@if (Model != null)
                            {
                                <tr>
                                    <td>@loop</td>
                                    <td>@Model.TotalQuote</td>
                                    <td>@Model.TotalProduct</td>
                                    <td>@Model.TotalPO</td>
                                    <td>@Model.TotalPOProduct</td>
                                    <td>@Model.PercentageConvert.ToString("0.##")%</td>
                                </tr>
                                loop += 1;
                            }*@
                    </tbody>
                </table>
            </div>
        </div>
    </section>

</div>
<link rel="stylesheet" href="https://adminlte.io/themes/v3/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css" />
<script src="https://adminlte.io/themes/v3/plugins/datatables/jquery.dataTables.min.js"></script>

<link rel="stylesheet" href="http://spms.synzeal.com/js/fixedHeader.dataTables.min.css" />
<script src="http://spms.synzeal.com/js/dataTables.fixedHeader.min.js"></script>
<script>
    $('#startdate').datepicker({
        autoclose: true,
        format: 'dd/mm/yyyy'
    })

    $('#enddate').datepicker({
        autoclose: true,
        format: 'dd/mm/yyyy'
    })
    var dt = new Date();
    dt.setMonth(dt.getMonth() - 3);

    $("#startdate").datepicker("update", dt);
    $("#enddate").datepicker("update", new Date());

    GetAccessedCompanyList();

    setTimeout(function () {
        GetSummary();
    }, 1000);

    function GetSummary() {
        var leftcompanyId = $("#leftcompanylist").val();
        var startDate = $('#startdate').val();
        var endDate = $('#enddate').val();
        $.ajax({
            type: "GET",
            url: "/Form/GetSummary?leftcompanyId=" + leftcompanyId + "&startDate=" + startDate + "&endDate=" + endDate,
            data: {},
            cache: false,
            success: function (data) {
                var str = "<tr><td colspan='7'>No Data Found</td></tr>";
                if (data != null && data.length > 0) {

                    str = "";
                    $(data).each(function (i, v) {
                        str += "<tr><td>" + (i + 1) + "</td><td>" + v.CompanyName + "</td>" +
                            "<td style='text-align:center'>" + v.TotalQuote + "</td>" +
                            "<td style='text-align:center'>" + v.TotalProduct + "</td>" +
                            "<td style='text-align:center'>" + v.TotalPO + "</td>" +
                            "<td style='text-align:center'>" + v.TotalPOProduct + "</td>" +
                            "<td style='text-align:center'>" + v.PercentageConvert.toFixed(2) + "%</td>" +
                            "<td style='text-align:center'>" + v.ActionRow + "</td>" +
                            "</tr>";
                    });
                }
                $("#tbody").html(str);
            }
        });
    }

    function DetailsOfConversion(companyId) {
        var loop = 1;
        var str = '<table class="table table-responsive dataTable no-footer" id="tblsummary" style="    display: inline-table;"><thead><tr><th>#</th><th>Quote #</th><th>PO No</th><th>Product Name</th><th>CAS No</th><th>CAT No</th><th>Price</th><th>Lead Time</th></thead>';
        $.ajax({
            url: '/Form/GetQuoteDataForConversionReport?Startdate=' + $("#startdate").val() + '&Enddate=' + $("#enddate").val() + '&companyId=' + companyId,
            data: {},
            type: 'GET',
            success: function (data) {

                $(data).each(function (i, v) {
                    var clsname = '';
                    if (v.PO !== '') {
                        clsname = 'clsbluebg';
                    }
                    str += '<tr class="' + clsname + '"><td>' + loop + '</td><td>' + v.quoteRef + '</td><td>' + v.PO + '</td><td>' + v.productname + '</td><td>' + v.casno + '</td><td>' + v.catno + '</td><td>' + v.price + '</td><td>' + v.leadtime + '</td></tr>';
                    loop += 1;
                });

                str += "</table>";
                $('#myModal').find('.modal-body').html(str);
                $('#myModal').modal({ show: true });
                $('#myModal').find(".modal-dialog").css("max-width", "80%");
                $('#myModal').find('.modal-body').css("max-width", "100%");

                $("#tblsummary").DataTable({
                    "pageLength": 50,

                });
            }
        });

    }
</script>
<style>
    tbody#tbody {
        font-size: 18px;
    }

    .clsbluebg {
        background: #1a1d20bf;
        color: #fff;
    }

    .paginate_button {
        padding: 10px;
        font-size: 18px;
        cursor: pointer;
    }

    .dataTables_info, .dataTables_length {
        float: left;
    }

    .dataTables_filter, .dataTables_length, .dataTables_paginate {
        margin: 10px;
    }

    .dataTables_info {
        margin-left: 10px;
    }

    #tblsummary_wrapper .clsbluebg {
        background: #1a1d202e;
        color: #000;
    }
</style>