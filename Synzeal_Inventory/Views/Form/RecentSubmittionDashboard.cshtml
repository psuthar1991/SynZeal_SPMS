@{
    ViewBag.Title = "Recent Product Submitted Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model List<Synzeal_Inventory.Models.ScientistDetailDashboardModel>
<section class="content-header">
    <h1>
        Recent Product Submittion Dashboard <a href="/Form/Dashboard" class="btn btn-primary" style="float:right">Go to Dashboard</a>
    </h1>
</section>
<section class="content">
    <div class="row">
        <div class="col-md-12">
            <div class="box box-primary">
                <form role="form">

                    <div class="box-body">
                        <div style="margin-bottom:10px">
                            <div class="col-md-3">
                                <label>Year: </label>
                                @Html.DropDownList("filterYear", (IEnumerable<SelectListItem>)ViewBag.YearItems, null, new { @class = "form-control" })
                            </div>
                            <div class="col-md-3">
                                <label>Month: </label>
                                @Html.DropDownList("filterMonth", (IEnumerable<SelectListItem>)ViewBag.MonthItems, null, new { @class = "form-control" })
                            </div>
                            <div class="col-md-3">
                                <input type="button" class="btn btn-primary" value="Search" onclick="$('#alltbl').DataTable().draw()" style="margin-top: 26px" />
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div style="float:right">
                            <a href="javascript:void(0)" style="float:right" class="btn btn-primary" onclick="saveall()">Save</a>
                        </div>
                        <div class="clearfix"> </div>
                        <br />
                        <table id="alltbl" class="table table-bordered table-striped" style="width:100%">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllclsSaverow" /></th>
                                    <th>#</th>
                                    <th>Product Name</th>
                                    <th>CAS No</th>
                                    <th>CAT No</th>
                                    <th>Quantity Demanded</th>
                                    <th>Quantity</th>
                                    <th>Batch No</th>
                                    <th>Sci. Name</th>
                                    <th>Category</th>
                                    <th>Sub. Dt</th>
                                    <th>Duration</th>
                                    <th>Quoted Lead Time</th>
                                    <th>PO No</th>
                                    <th>No Of Steps of Final Route</th>
                                    <th>Earlier Synthesized</th>
                                    <th>Purification By</th>
                                    <th>API Category</th>
                                    <th>Spectral Data Attachment</th>
                                </tr>
                            </thead>
                        </table>

                    </div>
                </form>
            </div>

        </div>
    </div>
    <!-- /.row -->
</section>
<script type="text/javascript">
    $(function () {

        var alltbl = $('#alltbl').DataTable({
            "ordering": false,
            "scrollX": true,
            "scrollY": "550px",
            //"autoWidth" : false,
            "processing": true, // for show progress bar
            "serverSide": true, // for process server side
            "filter": true, // this is for disable filter (search box)
            "pageLength": 25,
            "fnDrawCallback": function (oSettings) {
                $("#selectAllclsSaverow").click(function () {
                    if ($(this).is(":checked")) {
                        $('.chksave').each(function () {
                            $(this).prop("checked", true);
                        });
                    }
                    else {
                        $(".chksave").each(function () {
                            $(this).prop("checked", false);
                        });
                    }
                });
            },
            "columnDefs":[],
            "language": { processing: '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span> ' },
            "initComplete": function (settings, json) {
            },
            "ajax": {
                "url": "../Form/LoadRecentSubmittionDashboard",
                "type": "POST",
                "datatype": "json",
                "data": function (d) {
                    d.filterYear = $("#filterYear").val();
                    d.filterWeek = $("#filterWeek").val();
                    d.filterMonth = $("#filterMonth").val();
                }
            },
            "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                $("td:nth-child(2)", nRow).html(iDisplayIndex + 1);
                return nRow;
            },
            "createdRow": function (row, data, dataIndex) {
            },
            "columns": [
                { "data": "FirstRaw" },
                { "data": null },
                { "data": "ProductName" },
                { "data": "CASNO" },
                { "data": "CATNoText" },
                { "data": "QuantityDemand" },
                { "data": "Quantity" },
                { "data": "BatchNo" },
                { "data": "ScientistName" },
                { "data": "DiffLevelText" },
                { "data": "SubmitedDateText" },
                { "data": "Duration" },
                { "data": "QuotedLeadTime" },
                { "data": "PONumberText" },
                { "data": "FinalRoute" },
                { "data": "EarlierSynthesized" },
                { "data": "PurificationBy" },
                { "data": "APIcategory" },
                { "data": "SpeDataAttachment" },
            ]

        });
    });

    $("#clsDifficultyLevel").each(function () {
        var difflevel = $(this).attr("data-DiffLevel");
        var quotedetailid = $(this).attr("data-quoteDetailsId");
        if (difflevel !== null && difflevel !== undefined) {
            $("#difflevel_" + quotedetailid).val(difflevel);
        }
    });

    function saveall() {
        var ids = [];
        var categories = [];
        $('.chksave').each(function () {
            if ($(this).is(':checked')) {
                ids.push($(this).val());
                categories.push($("#difflevel_" + $(this).val()).val());
            }
        });

        if (ids.length === 0) {
            toastr.error("Please select atleast one Product");
            return false;
        }

        $.ajax({
            url: '/Form/SaveAllRecentDashboard',
            data: { id: ids, category: categories },
            type: 'POST',
            traditional: true, // add this
            dataType: 'json',
            success: function (data) {
                if (data.success) {
                    toastr.success("Successfully updated all selected entries.");
                }
            }
        });
    }
</script>